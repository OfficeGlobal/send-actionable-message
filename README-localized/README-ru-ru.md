# Отправка сообщений с действиями через Microsoft Graph

Пример командной строки, использующей [библиотеку проверки подлинности (Майкрософт)](https://www.nuget.org/packages/Microsoft.Identity.Client) и [клиентскую библиотеку Microsoft Graph](https://www.nuget.org/packages/Microsoft.Graph/) для отправки [сообщения с действиями](https://docs.microsoft.com/en-us/outlook/actionable-messages/) прошедшему проверку подлинности пользователю.

## Запуск примера

Чтобы запустить пример, требуется зарегистрировать приложение на [портале регистрации приложений](https://apps.dev.microsoft.com) для получения идентификатора приложения, затем скопировать этот идентификатор приложения в файл [App.config](./App.config).

### Регистрация приложения

1. Перейдите на [портал регистрации приложений](https://apps.dev.microsoft.com) и войдите с помощью учетной записи Майкрософт или учетной записи Office 365.
1. Нажмите кнопку **Добавить приложение**. Введите имя приложения и нажмите кнопку **Создать приложение**.
1. Нажмите кнопку **Добавить платформу** и выберите **Мобильное приложение**.
1. Нажмите кнопку **Сохранить**

> **Примечание.** На момент создания этой статьи на портале возникает ошибка, добавляющая запись платформы **Веб** в регистрацию при нажатии кнопки **Сохранить**. В этом случае просто нажмите кнопку **Удалить** для платформы **Веб** и вновь щелкните **Сохранить**.

После завершения регистрация должна выглядеть примерно так:

![Снимок экрана с завершенной регистрацией на портале регистрации приложений](readme-images/app-registration.PNG)

Скопируйте значение **Идентификатор приложения**.

### Добавление идентификатора приложения в проект

1. Откройте файл [App.config](App.config) в обозревателе решений.
1. Найдите следующую строку: 

    ```xml
    <add key="applicationId" value="" />
    ```
1. Вставьте идентификатор приложения, скопированный с портала, в параметр `value` и сохраните файл. Например, при использовании идентификатора приложения из снимка экрана выше строка будет обновлена следующим образом:

    ```xml
    <add key="applicationId" value="b9831d46-3f6b-4c77-82d3-220a9ea4e5ba" />
    ```

### Сборка и запуск приложения

Нажмите клавишу **F5** в Visual Studio, чтобы выполнить сборку и запустить приложение. Должно отобразиться окно командной строки, а затем должно появиться всплывающее окно проверки подлинности.

![Снимок экрана со всплывающим окном проверки подлинности](readme-images/auth-popup.PNG)

Войдите с помощью учетной записи Майкрософт (с использованием почтового ящика Outlook.com) или учетной записи Office 365 (Exchange Online). Проверьте список запрошенных разрешений и щелкните **Принять** или **Отмена**. (**Примечание.** Выбор варианта **Отмена** приведет к возвращению ошибки приложением без отправки сообщения.)

В окне командной строки должен выводиться текст `Сообщение отправлено`, указывающий на успех действия. Проверьте наличие сообщения в своей папке "Входящие" с помощью Outlook в Интернете.

### Изменение карточки сообщения или текста

Вы можете воспользоваться различными форматами для карточки и текста сообщения, изменив файлы [Card.json](Card.json) и [MessageBody.html](MessageBody.html) соответственно. Чтобы быстро создать полезные данные тестовых карточек, посетите страницу [https://messagecardplayground.azurewebsites.net/](https://messagecardplayground.azurewebsites.net/).